<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¼ë–¼ë¡œë˜ ë§ŒëŠ¥ íŠ¸ë ˆì´ë”© ê³„ì‚°ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); }
        
        /* íƒ­ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .tab-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen pb-20">

    <div class="fixed inset-0 pointer-events-none bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-[#0f172a] to-[#0f172a] -z-10"></div>
    <div class="fixed top-0 left-1/2 -translate-x-1/2 w-[600px] h-[600px] bg-emerald-600/10 blur-[120px] rounded-full pointer-events-none -z-10"></div>

    <div class="container mx-auto px-4 py-8 max-w-2xl">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">ğŸ’° ë¼ë–¼ë¡œë˜ íŠ¸ë ˆì´ë”© ë„ìš°ë¯¸</h1>
            <p class="text-slate-500 text-sm">ë¬¼íƒ€ê¸° Â· ìˆ˜ìµë¥  ì‹œë®¬ë ˆì´ì…˜ Â· ë¶„í• ë§¤ìˆ˜ ê³„íš</p>
        </header>

        <div class="glass-card p-1 rounded-xl flex mb-6">
            <button class="tab-btn active flex-1 py-3 rounded-lg text-sm font-bold text-slate-400 transition-all" onclick="switchTab('avg')">ğŸ’§ ë¬¼íƒ€ê¸° ê³„ì‚°</button>
            <button class="tab-btn flex-1 py-3 rounded-lg text-sm font-bold text-slate-400 transition-all" onclick="switchTab('target')">ğŸ¯ ëª©í‘œ ì‹œë®¬ë ˆì´ì…˜</button>
            <button class="tab-btn flex-1 py-3 rounded-lg text-sm font-bold text-slate-400 transition-all" onclick="switchTab('plan')">ğŸ° ë¶„í•  ë§¤ìˆ˜</button>
        </div>

        <div id="tab-avg" class="tab-content active">
            <div class="glass-card rounded-2xl p-6 space-y-6">
                <h2 class="text-lg font-bold text-blue-300 mb-4 border-b border-slate-700 pb-2">ë³´ìœ  ìì‚° ì…ë ¥</h2>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">í˜„ì¬ í‰ë‹¨ê°€</label>
                        <input type="number" id="avg-current-price" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white font-bold" placeholder="ì˜ˆ: 1000">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">ë³´ìœ  ìˆ˜ëŸ‰</label>
                        <input type="number" id="avg-current-qty" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white font-bold" placeholder="ì˜ˆ: 50">
                    </div>
                </div>

                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700/50">
                    <h3 class="text-sm font-bold text-emerald-400 mb-3"><i class="fa-solid fa-cart-plus"></i> ì¶”ê°€ ë§¤ìˆ˜ (ë¬¼íƒ€ê¸°)</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">ì‹ ê·œ ë§¤ìˆ˜ ê°€ê²©</label>
                            <input type="number" id="avg-new-price" class="w-full bg-slate-900 border border-slate-600 rounded-xl p-3 text-emerald-400 font-bold" placeholder="í˜„ì¬ê°€">
                        </div>
                        <div>
                            <label class="block text-xs text-slate-400 mb-1">ë§¤ìˆ˜ ê¸ˆì•¡ (ì´ì•¡)</label>
                            <input type="number" id="avg-new-amount" class="w-full bg-slate-900 border border-slate-600 rounded-xl p-3 text-emerald-400 font-bold" placeholder="ì–¼ë§ˆì¹˜ ì‚´ê¹Œ?">
                        </div>
                    </div>
                </div>

                <button onclick="calcWatering()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/50 transition-all">
                    ê²°ê³¼ í™•ì¸í•˜ê¸°
                </button>

                <div id="avg-result" class="hidden glass-card bg-slate-800/80 p-6 rounded-xl text-center border border-blue-500/30">
                    <p class="text-xs text-slate-400 mb-1">ìµœì¢… ì˜ˆìƒ í‰ë‹¨ê°€</p>
                    <div class="text-4xl font-bold text-white mb-2" id="res-final-avg">0</div>
                    <div class="flex justify-center gap-4 text-sm">
                        <span class="text-slate-400">í‰ë‹¨ê°€ ë³€í™”: <span id="res-change-rate" class="font-bold text-emerald-400">0%</span></span>
                        <span class="text-slate-400">ì´ ë³´ìœ ëŸ‰: <span id="res-total-qty" class="font-bold text-white">0</span></span>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-target" class="tab-content">
            <div class="glass-card rounded-2xl p-6 space-y-6">
                <div class="flex items-center gap-2 mb-4 border-b border-slate-700 pb-2">
                    <h2 class="text-lg font-bold text-purple-300">í–‰ë³µíšŒë¡œ ì‹œë®¬ë ˆì´í„°</h2>
                    <span class="text-xs bg-purple-900 text-purple-200 px-2 py-0.5 rounded">ì—­ì‚° ê¸°ëŠ¥</span>
                </div>
                
                <p class="text-sm text-slate-400 bg-slate-800 p-3 rounded-lg">
                    "ë‚´ê°€ ì›í•˜ëŠ” í‰ë‹¨ê°€ë¥¼ ë§Œë“¤ë ¤ë©´ ì–¼ë§ˆë¥¼ ë” ì‚¬ì•¼í• ê¹Œ?"ë¥¼ ê³„ì‚°í•´ì¤ë‹ˆë‹¤.
                </p>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">í˜„ì¬ í‰ë‹¨ê°€</label>
                        <input type="number" id="sim-avg" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white" value="1000">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">í˜„ì¬ ë³´ìœ  ê¸ˆì•¡(ì´ì•¡)</label>
                        <input type="number" id="sim-total" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white" placeholder="ì˜ˆ: 1000000">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                     <div>
                        <label class="block text-xs text-slate-400 mb-1">í˜„ì¬ ì‹œì¥ ê°€ê²©(ì‚´ ê°€ê²©)</label>
                        <input type="number" id="sim-market-price" class="w-full bg-slate-900 border border-slate-600 rounded-xl p-3 text-emerald-400 font-bold" value="800">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1 text-purple-400">ğŸ¯ ëª©í‘œ í‰ë‹¨ê°€</label>
                        <input type="number" id="sim-target" class="w-full bg-purple-900/30 border border-purple-500/50 rounded-xl p-3 text-purple-300 font-bold border-2" placeholder="ì–¼ë§ˆë¡œ ë§ì¶œê¹Œ?">
                    </div>
                </div>

                <button onclick="calcSimulation()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-purple-900/50 transition-all">
                    ì–¼ë§ˆë©´ ë¼? ê³„ì‚°í•˜ê¸°
                </button>

                <div id="sim-result" class="hidden glass-card bg-slate-800/80 p-6 rounded-xl text-center border border-purple-500/30">
                    <p class="text-xs text-slate-400 mb-1">í•„ìš”í•œ ì¶”ê°€ ë§¤ìˆ˜ ê¸ˆì•¡</p>
                    <div class="text-3xl font-bold text-white mb-2" id="res-needed-cash">0 KRW</div>
                    <p class="text-xs text-slate-500 mt-2" id="res-sim-desc"></p>
                </div>
            </div>
        </div>

        <div id="tab-plan" class="tab-content">
            <div class="glass-card rounded-2xl p-6 space-y-6">
                <h2 class="text-lg font-bold text-pink-300 mb-4 border-b border-slate-700 pb-2">ë¶„í•  ë§¤ìˆ˜ ê³„íší‘œ</h2>
                
                <div>
                    <label class="block text-xs text-slate-400 mb-1">ì´ íˆ¬ì ì˜ˆì • ê¸ˆì•¡</label>
                    <input type="number" id="plan-total" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white font-bold" placeholder="ì˜ˆ: 10000000">
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">í˜„ì¬ê°€ (ì‹œì‘)</label>
                        <input type="number" id="plan-start" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white" placeholder="1000">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">ë¶„í•  íšŸìˆ˜</label>
                        <select id="plan-count" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white">
                            <option value="3">3ë¶„í• </option>
                            <option value="5">5ë¶„í• </option>
                            <option value="10">10ë¶„í• </option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">ê°„ê²© (-%)</label>
                        <input type="number" id="plan-gap" class="w-full bg-slate-800 border border-slate-600 rounded-xl p-3 text-white" value="5">
                    </div>
                </div>

                <div class="flex gap-2 mb-4">
                    <button onclick="setPlanStyle('even')" id="btn-even" class="plan-style-btn flex-1 bg-slate-700 py-2 rounded-lg text-xs active">ê· ë“± ë¶„í•  (1:1:1)</button>
                    <button onclick="setPlanStyle('pyramid')" id="btn-pyramid" class="plan-style-btn flex-1 bg-slate-800 py-2 rounded-lg text-xs text-slate-400">í”¼ë¼ë¯¸ë“œ (1:2:3)</button>
                </div>

                <button onclick="calcPlan()" class="w-full bg-pink-600 hover:bg-pink-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-pink-900/50 transition-all">
                    ê³„íší‘œ ìƒì„±
                </button>

                <div id="plan-result" class="hidden mt-4">
                    <table class="w-full text-sm text-left text-slate-400">
                        <thead class="text-xs text-slate-500 uppercase bg-slate-800">
                            <tr>
                                <th class="px-3 py-3 rounded-l-lg">ì°¨ìˆ˜</th>
                                <th class="px-3 py-3">ë§¤ìˆ˜ ê°€ê²©</th>
                                <th class="px-3 py-3 rounded-r-lg text-right">íˆ¬ìê¸ˆ</th>
                            </tr>
                        </thead>
                        <tbody id="plan-table-body" class="divide-y divide-slate-700">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script>
        // === íƒ­ ê¸°ëŠ¥ ===
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById('tab-' + tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // === 1. ë¬¼íƒ€ê¸° ê³„ì‚° ===
        function calcWatering() {
            const currentPrice = parseFloat(document.getElementById('avg-current-price').value);
            const currentQty = parseFloat(document.getElementById('avg-current-qty').value);
            const newPrice = parseFloat(document.getElementById('avg-new-price').value);
            const newAmount = parseFloat(document.getElementById('avg-new-amount').value);

            if(!currentPrice || !currentQty || !newPrice || !newAmount) {
                alert("ëª¨ë“  ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return;
            }

            const currentTotal = currentPrice * currentQty;
            const newQty = newAmount / newPrice;
            
            const finalTotalAmt = currentTotal + newAmount;
            const finalTotalQty = currentQty + newQty;
            const finalAvg = finalTotalAmt / finalTotalQty;

            const changeRate = ((finalAvg - currentPrice) / currentPrice) * 100;

            document.getElementById('res-final-avg').innerText = Math.round(finalAvg).toLocaleString();
            document.getElementById('res-total-qty').innerText = finalTotalQty.toFixed(4);
            
            const rateEl = document.getElementById('res-change-rate');
            rateEl.innerText = changeRate.toFixed(2) + '%';
            rateEl.className = changeRate > 0 ? 'font-bold text-red-400' : 'font-bold text-emerald-400'; // í‰ë‹¨ ë‚®ì•„ì§€ë©´ ì´ˆë¡ìƒ‰

            document.getElementById('avg-result').classList.remove('hidden');
        }

        // === 2. ì‹œë®¬ë ˆì´ì…˜ (ì—­ì‚°) ===
        function calcSimulation() {
            const avg = parseFloat(document.getElementById('sim-avg').value);
            const total = parseFloat(document.getElementById('sim-total').value);
            const market = parseFloat(document.getElementById('sim-market-price').value);
            const target = parseFloat(document.getElementById('sim-target').value);

            if(!avg || !total || !market || !target) { alert("ê°’ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            // ë…¼ë¦¬ ì²´í¬: í˜„ì¬ í‰ë‹¨ë³´ë‹¤ ë‚®ê²Œ ì¡ìœ¼ë ¤ë©´, ì‹œì¥ê°€ê°€ í‰ë‹¨ë³´ë‹¤ ë‚®ì•„ì•¼ í•¨ (ë¬¼íƒ€ê¸°)
            if(market >= avg && target < avg) {
                alert("ì‹œì¥ ê°€ê²©ì´ í‰ë‹¨ë³´ë‹¤ ë†’ì„ ë•ŒëŠ” ë¬¼íƒ€ê¸°ë¡œ í‰ë‹¨ì„ ë‚®ì¶œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return;
            }

            // ì—­ì‚° ê³µì‹
            // (ê¸°ì¡´ì´ì•¡ + X) / (ê¸°ì¡´ìˆ˜ëŸ‰ + X/ì‹œì¥ê°€) = ëª©í‘œí‰ë‹¨
            // X = (ëª©í‘œí‰ë‹¨*ê¸°ì¡´ìˆ˜ëŸ‰ - ê¸°ì¡´ì´ì•¡) / (1 - ëª©í‘œí‰ë‹¨/ì‹œì¥ê°€)
            
            const currentQty = total / avg;
            
            // X * (1 - target/market) = target*qty - total
            // X = (target*qty - total) / (1 - target/market)
            
            const numerator = (target * currentQty) - total;
            const denominator = 1 - (target / market);

            if(denominator === 0) { alert("ê³„ì‚° ë¶ˆê°€ ìˆ˜ì¹˜ì…ë‹ˆë‹¤."); return; }
            
            const neededCash = numerator / denominator;

            if(neededCash < 0) {
                 alert("ëª©í‘œ í‰ë‹¨ê°€ê°€ ì´ë¯¸ ë‹¬ì„±ë˜ì—ˆê±°ë‚˜, ë¶ˆê°€ëŠ¥í•œ ìˆ˜ì¹˜ì…ë‹ˆë‹¤."); return;
            }

            document.getElementById('res-needed-cash').innerText = Math.round(neededCash).toLocaleString() + " ì›";
            document.getElementById('res-sim-desc').innerText = `í˜„ì¬ê°€(${market}ì›)ì—ì„œ ${Math.round(neededCash/market).toLocaleString()}ê°œë¥¼ ë” ì‚¬ë©´ í‰ë‹¨ê°€ ${target}ì›ì´ ë©ë‹ˆë‹¤.`;
            document.getElementById('sim-result').classList.remove('hidden');
        }

        // === 3. ë¶„í•  ë§¤ìˆ˜ ê³„íš ===
        let planStyle = 'even'; // even or pyramid

        function setPlanStyle(style) {
            planStyle = style;
            document.querySelectorAll('.plan-style-btn').forEach(b => {
                b.classList.remove('active', 'bg-slate-700', 'text-white');
                b.classList.add('bg-slate-800', 'text-slate-400');
            });
            const btn = document.getElementById('btn-' + style);
            btn.classList.add('active', 'bg-slate-700', 'text-white');
            btn.classList.remove('bg-slate-800', 'text-slate-400');
        }

        function calcPlan() {
            const total = parseFloat(document.getElementById('plan-total').value);
            const startPrice = parseFloat(document.getElementById('plan-start').value);
            const count = parseInt(document.getElementById('plan-count').value);
            const gap = parseFloat(document.getElementById('plan-gap').value);

            if(!total || !startPrice) { alert("ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            let rows = "";
            let weights = [];
            
            if(planStyle === 'even') {
                for(let i=0; i<count; i++) weights.push(1);
            } else {
                for(let i=1; i<=count; i++) weights.push(i); // 1, 2, 3...
            }
            
            const weightSum = weights.reduce((a,b)=>a+b, 0);
            
            for(let i=0; i<count; i++) {
                const price = startPrice * (1 - (gap * i / 100));
                const amount = total * (weights[i] / weightSum);
                
                rows += `
                <tr class="border-b border-slate-700 last:border-0 hover:bg-slate-800/50">
                    <td class="px-3 py-3 font-bold text-slate-300">${i+1}ì°¨</td>
                    <td class="px-3 py-3 font-mono text-emerald-400">${Math.round(price).toLocaleString()}</td>
                    <td class="px-3 py-3 text-right font-mono text-white">${Math.round(amount).toLocaleString()}</td>
                </tr>
                `;
            }

            document.getElementById('plan-table-body').innerHTML = rows;
            document.getElementById('plan-result').classList.remove('hidden');
        }
    </script>
</body>
</html>
